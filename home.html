<html>
<head>

    <title>FireWatch</title>

    <link rel="icon" type="image/x-icon" href="icon.ico">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; width: 100%; }
        #map { height: 100%; }
    </style>
   
</head>
<body>

<div id="map">
    <script>

        // set the beginning location for the map
        var map = L.map('map').setView([38, -98], 4);   // [latitude, longitude], zoomFactor

        // add OpenStreetMap layer
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // this is for the api
        async function fetchWildfireAlerts() {
            try {
                const response = await fetch('https://api.weather.gov/alerts/active?event=Fire%20Warning');
                const data = await response.json();

                console.log(data);

                let fireAlerts = data.features.filter(alert =>
                    alert.properties.event.includes("Fire") ||
                    alert.properties.event.includes("Wildfire") ||
                    alert.properties.event.includes("Red Flag Warning")
                );

                if (fireAlerts.length == 0) {
                    alert("No active wildfire alerts found.");
                    return;
                }

                fireAlerts.forEach(alert => {
                    let alertDetails = alert.properties;
                    let alertLocation = alertDetails.areaDesc || "Unknown Location";

                    if (alert.geometry && alert.geometry.coordinates) {
                        let coords = alert.geometry.coordinates;

                        if (Array.isArray(coords[0])) {
                            coords = coords[0];
                        }
                        let lat = coords[1];
                        let lon = coords[0];

                        L.marker([lat, lon]).addTo(map)
                        .bindPopup(`<b>${alertDetails.headline}</b><br>${alertDetails.description}<br><b>Location:</b> ${alertLocation}`);
                    } else {
                        console.warn(`No coordinates for: ${alertDetails.headline}`);

                    }

                });
            } catch (error) {
                console.error("Error fetching wildfire alerts:", error);
            }
        }

        fetchWildfireAlerts();
    </script>
</div>

</body>
</html>
